<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>দিন মুসলিম - ওয়েব নোটিফিকেশন</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f2f5; text-align: center; padding: 20px; }
        .container { background-color: white; padding: 30px 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; }
        h1 { color: #333; }
        p { color: #666; margin-bottom: 30px; line-height: 1.6; }
        .button { background-color: #007bff; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: background-color 0.3s; }
        .button:hover { background-color: #0056b3; }
        #status { margin-top: 20px; font-weight: bold; font-size: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">দিন মুসলিম</h1>
        <p id="description">নামাজের সময় এবং অন্যান্য ইসলামিক বিষয়ে সরাসরি আপনার ব্রাউজারে অ্যালার্ট পেতে নিচের বাটনে ক্লিক করুন।</p>
        <button class="button" id="notify-button" onclick="enableNotifications()">নোটিফিকেশন চালু করুন</button>
        <div id="status"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>
    <script>
        // আপনার Firebase প্রজেক্টের পাবলিক কনফিগারেশন
        const firebaseConfig = {
            apiKey: "AIza...", // আপনার Firebase API Key দিন
            authDomain: "muslimdays-87c66.firebaseapp.com",
            projectId: "muslimdays-87c66",
            storageBucket: "muslimdays-87c66.appspot.com",
            messagingSenderId: "404159341424",
            appId: "1:404159341424:web:c4313c83ac1c17f16725b5"
        };
        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        // --- ভাষা পরিবর্তনের জন্য নতুন কোড ---
        const pageText = {
            bn: {
                title: 'দিন মুসলিম',
                description: 'নামাজের সময় এবং অন্যান্য ইসলামিক বিষয়ে সরাসরি আপনার ব্রাউজারে অ্যালার্ট পেতে নিচের বাটনে ক্লিক করুন।',
                button: 'নোটিফিকেশন চালু করুন',
                status_error_no_id: '❌ ত্রুটি: ব্যবহারকারীর আইডি পাওয়া যায়নি।',
                status_wait_permission: 'অনুমতির জন্য অপেক্ষা করা হচ্ছে...',
                status_wait_token: 'টোকেন তৈরি করা হচ্ছে...',
                status_wait_server: 'তথ্য সার্ভারে পাঠানো হচ্ছে...',
                status_success: '✅ নোটিফিকেশন সফলভাবে চালু হয়েছে!',
                status_error_generic: '❌ নোটিফিকেশন চালু করা যায়নি। আবার চেষ্টা করুন।'
            },
            en: {
                title: 'Din Muslim',
                description: 'Click the button below to get alerts for prayer times and other Islamic events directly in your browser.',
                button: 'Enable Notifications',
                status_error_no_id: '❌ Error: User ID not found.',
                status_wait_permission: 'Waiting for permission...',
                status_wait_token: 'Generating token...',
                status_wait_server: 'Sending info to server...',
                status_success: '✅ Notifications enabled successfully!',
                status_error_generic: '❌ Could not enable notifications. Please try again.'
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const lang = urlParams.get('lang') || 'bn'; // URL থেকে ভাষা নিন, না পেলে 'bn'
        
        document.getElementById('title').textContent = pageText[lang].title;
        document.getElementById('description').textContent = pageText[lang].description;
        document.getElementById('notify-button').textContent = pageText[lang].button;
        // --- ভাষা পরিবর্তনের কোড শেষ ---

        function enableNotifications() {
            const statusDiv = document.getElementById('status');
            const chatId = urlParams.get('chat_id');
            if (!chatId) {
                statusDiv.textContent = pageText[lang].status_error_no_id;
                statusDiv.style.color = 'red';
                return;
            }
            statusDiv.textContent = pageText[lang].status_wait_permission;
            Notification.requestPermission().then((permission) => {
                if (permission === 'granted') {
                    statusDiv.textContent = pageText[lang].status_wait_token;
                    return messaging.getToken();
                } else { throw new Error('Permission not granted'); }
            }).then((fcmToken) => {
                statusDiv.textContent = pageText[lang].status_wait_server;
                return fetch('/save-fcm-token', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chatId: chatId, fcmToken: fcmToken })
                });
            }).then(response => response.json()).then(data => {
                if (data.success) {
                    statusDiv.textContent = pageText[lang].status_success;
                    statusDiv.style.color = 'green';
                } else { throw new Error(data.message || 'Server error'); }
            }).catch((err) => {
                console.error('Error:', err);
                statusDiv.textContent = pageText[lang].status_error_generic;
                statusDiv.style.color = 'red';
            });
        }
    </script>
</body>
  </html>
